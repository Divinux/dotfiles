#!/usr/bin/env bash

# Convert between hex and RGB color formats.
# Usage:
#   colorconvert "#rrggbb"
#   colorconvert "r,g,b"

colorconvert() {
    local input="$1"

    # Function: Hex → RGB
    hex_to_rgb() {
        local hex="${1#'#'}"  # remove leading '#'
        if [[ ${#hex} -eq 3 ]]; then
            # Expand shorthand like #abc → #aabbcc
            hex="${hex:0:1}${hex:0:1}${hex:1:1}${hex:1:1}${hex:2:1}${hex:2:1}"
        fi
        local r=$((16#${hex:0:2}))
        local g=$((16#${hex:2:2}))
        local b=$((16#${hex:4:2}))
        echo "$r,$g,$b"
    }

    # Function: RGB → Hex
    rgb_to_hex() {
        IFS=',' read -r r g b <<< "$1"
        printf "#%02x%02x%02x\n" "$r" "$g" "$b"
    }

    # Detect input type
    if [[ "$input" =~ ^#?[0-9A-Fa-f]{3}$ || "$input" =~ ^#?[0-9A-Fa-f]{6}$ ]]; then
        hex_to_rgb "$input"
    elif [[ "$input" =~ ^[0-9]{1,3},[0-9]{1,3},[0-9]{1,3}$ ]]; then
        rgb_to_hex "$input"
    else
        echo "Usage:"
        echo "  colorconvert \"#rrggbb\""
        echo "  colorconvert \"r,g,b\""
        return 1
    fi
}
